apiVersion: helm.fluxcd.io/v1
kind: HelmRelease
metadata:
  name: traefik
  namespace: admin
spec:
  chart:
    git: git@github.com:traefik/traefik-helm-chart
    ref: master
    path: traefik
  values:
    imageTag: 2.4.8
    loadBalancerIP: 10.140.15.250
    dashboard:
      domain: traefik-ss-00.sandbox.platform.hmcts.net
    accessLogs:
      enabled: true
    tls:
      stores:
        default:
          defaultCertificate:
            key: default-cert
      options: myTLSOptions
    myTLSOptions:
      enabled: true
      minVersion: VersionTLS12
      cipherSuites:
        [
          "TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384",
          "TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256",
          "TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA256",
          "TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA",
        ]
    autoscaling:
      minReplicas: 1
      maxReplicas: 2
    metrics:
      prometheus:
        enabled: true
        buckets: [0.1,0.3,1.2,5]
        service:
          # Set a custom service name
          name:
            traefik-metrics
          annotations:
            prometheus.io/scrape: "true"
          port: 9100
          type: ClusterIP
    deployment:
      podAnnotations:
        prometheus.io/port: "9100"
        prometheus.io/scrape: "true"
