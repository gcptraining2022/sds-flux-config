---
apiVersion: helm.fluxcd.io/v1
kind: HelmRelease
metadata:
  name: vh-admin-web
  namespace: vh
  annotations:
    fluxcd.io/automated: "true"
    filter.fluxcd.io/tag.nodejs: glob:prod-*
spec:
  releaseName: vh-admin-web
  chart:
    git: git@github.com:hmcts/vh-admin-web
    path: charts/vh-admin-web
    ref: helm_chart_setup
values:
java:
  replicas: 2
  useInterpodAntiAffinity: false
  image: 'sdshmctspublic.azurecr.io/vh/admin-web:latest'
  applicationPort: 80
  ingressHost: vh-admin-web-{{ .Values.global.environment }}.platform.hmcts.net
  releaseNameOverride: vh-admin-web
  aadIdentityName: vh
  keyVaults:
    vh-infra-core:
      excludeEnvironmentSuffix: false
      resourceGroup: vh-infra-core-{{ .Values.global.environment }}
      usePodIdentity: true
      secrets:
        - vh-admin-web-key
        - vh-admin-web-appid
        - vh-admin-web-identifieruris
        - vh-infra-core-AppInsightsKey
        - TestApiDb-connection-str
        - testdefaultpassword
  environment:
    APPINSIGHTS_INSTRUMENTATIONKEY: $(APPLICATIONINSIGHTS_INSTRUMENTATIONKEY)
    APPINSIGHTS_PROFILERFEATURE_VERSION: disabled
    APPINSIGHTS_SNAPSHOTFEATURE_VERSION: disabled
    APPLICATIONINSIGHTS__INSTRUMENTATIONKEY: $(APPLICATIONINSIGHTS_INSTRUMENTATIONKEY)
    APPLICATIONINSIGHTS_CONNECTION_STRING: InstrumentationKey=$(INSTRUMENTATIONKEY)
    APPLICATIONINSIGHTSAGENT_EXTENSION_VERSION: ~2
    AZUREAD__AUTHORITY: https://login.microsoftonline.com/fb6e0e22-0da3-4c35-972a-9d61eb256508
    AZUREAD__CLIENTSECRET: $(AZUREAD__CLIENTSECRET)
    AZUREAD__CLIENTID: $(AZUREAD__CLIENTID)
    AZUREAD__TENANTID: "531ff96d-0ae9-462a-8d2d-bec7c0b42082"
    AZUREAD__POSTLOGOUTREDIRECTURI: https://vh-admin-web-{{ .Values.global.environment }}.hearings.reform.hmcts.net/logout
    AZUREAD__REDIRECTURI: https://vh-admin-web-{{ .Values.global.environment }}.hearings.reform.hmcts.net/home
    DIAGNOSTICSERVICES_EXTENSION_VERSION: disabled
    DISABLEHTTPSREDIRECTION: true
    INSTRUMENTATIONENGINE_EXTENSION_VERSION: disabled
    ISLIVE: false
    KINLYCONFIGURATION__CONFERENCEPHONENUMBER: +442033183131
    NOTIFYCONFIGURATION__APIKEY: dev_test_key-01b5904d-68b4-4b34-9881-699bb856c1f0-04200db0-ef03-46a0-98f6-36f83ff42395
    SNAPSHOTDEBUGGER_EXTENSION_VERSION: disabled
    TESTUSERSECRETS__TESTUSERNAMESTEM: '@hearings.reform.hmcts.net'
    USESERVICEBUSFAKE: false
    USESERVICEBUSFAKE__FALSE: false
    XDT_MICROSOFTAPPLICATIONINSIGHTS_BASEEXTENSIONS: disabled
    XDT_MICROSOFTAPPLICATIONINSIGHTS_MODE: default
