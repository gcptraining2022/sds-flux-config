---
apiVersion: helm.fluxcd.io/v1
kind: HelmRelease
metadata:
  name: vh-notification-api
  namespace: vh
  annotations:
    fluxcd.io/automated: "true"
    filter.fluxcd.io/tag.nodejs: glob:prod-*
spec:
  releaseName: vh-notification-api
  chart:
    git: git@github.com:hmcts/vh-notification-api
    path: charts/vh-notification-api
    ref: helm_chart_setup
values:
java:
  replicas: 2
  useInterpodAntiAffinity: false
  image: 'sdshmctspublic.azurecr.io/vh/notification-api:latest'
  applicationPort: 80
  ingressHost: vh-notification-api-{{ .Values.global.environment }}.platform.hmcts.net
  releaseNameOverride: vh-notification-api
  aadIdentityName: vh
  keyVaults:
    vh-infra-core:
      excludeEnvironmentSuffix: false
      resourceGroup: vh-infra-core-{{ .Values.global.environment }}
      usePodIdentity: true
      secrets:
        - vh-notification-api-key
        - vh-notification-api-appid
        - vh-notification-api-identifieruris
        - vh-infra-core-AppInsightsKey
        - TestApiDb-connection-str
        - testdefaultpassword
  environment:
    APPINSIGHTS_INSTRUMENTATIONKEY: $(APPLICATIONINSIGHTS_INSTRUMENTATIONKEY)
    APPINSIGHTS_PROFILERFEATURE_VERSION: disabled
    APPINSIGHTS_SNAPSHOTFEATURE_VERSION: disabled
    APPLICATIONINSIGHTS_INSTRUMENTATIONKEY: $(APPLICATIONINSIGHTS_INSTRUMENTATIONKEY)
    APPLICATIONINSIGHTS_CONNECTION_STRING: InstrumentationKey=$(INSTRUMENTATIONKEY)
    APPLICATIONINSIGHTSAGENT_EXTENSION_VERSION: ~2
    AZUREAD__CLIENTSECRET: $(AZUREAD__CLIENTSECRET)
    AZUREAD__CLIENTID: $(AZUREAD__CLIENTID)
    AZUREAD__TENANTID: "531ff96d-0ae9-462a-8d2d-bec7c0b42082"
    AZUREAD__VHNOTIFICATIONAPIRESOURCEID: $(AZUREAD__VHNOTIFICATIONAPIRESOURCEID)
    CONNECTIONSTRINGS__VHNOTIFICATIONSAPI:  < - - - - - 
    DIAGNOSTICSERVICES_EXTENSION_VERSION: disabled
    DISABLEHTTPSREDIRECTION: true
    INSTRUMENTATIONENGINE_EXTENSION_VERSION: disabled
    NOTIFYCONFIGURATION__APIKEY: < - - - - - 
    NOTIFYCONFIGURATION__CALLBACKSECRET: < - - - - - 
    SNAPSHOTDEBUGGER_EXTENSION_VERSION: disabled
    VHSERVICES__VHNOTIFICATIONAPIRESOURCEID: < - - - - - 
    XDT_MICROSOFTAPPLICATIONINSIGHTS_BASEEXTENSIONS: disabled
    XDT_MICROSOFTAPPLICATIONINSIGHTS_MODE: default
